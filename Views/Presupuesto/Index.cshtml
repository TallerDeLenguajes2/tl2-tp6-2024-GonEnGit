
@using tl2_tp6_2024_GonEnGit.Models

@using EspacioModels
@using EspacioViewModels

@model PresupuestoViewModel

<h1 class="px-3 display-6">Clientes</h1>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css">
@foreach (Cliente cli in Model.Clientes)
{
<div class="container-fluid text-center">
    <table class="table table-striped table-bordered table-secondary align-middle">
        <thead class="font-weight-bold">
            <tr>
                <td class="col-sm-1">Id</td>
                <td class="col-sm-2">Nombre</td>
                <td class="col-sm-1">Datos</td>
                @if (Model.Presupuestos.Any(p => p.IdCliente == cli.IdCliente))
                {
                <td class="col-sm-1">Presupuestos</td>
                }
                
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>@cli.IdCliente</td>
                <td>@cli.Nombre</td>
                <td>
                    <select name="" id="">
                        <option value="">@cli.Direccion</option>
                        <option value="">@cli.Telefono</option>
                    </select>
                </td>
                @if (Model.Presupuestos.Any(p => p.IdCliente == cli.IdCliente))
                {
                <form asp-controller="Presupuesto" asp-action="AgregarDetalle">
                    <td>
                        <input type="hidden" asp-for="@cli.IdCliente">
                        <select name="" id="">
                        @foreach (Presupuesto pres in Model.Presupuestos)
                        {
                            @if (pres.IdCliente == cli.IdCliente)
                            {
                            <option value="@pres.IdPresupuesto">@pres.FechaCreacion</option>
                            }
                        }
                        </select>
                    </td> <!-- te está dando un foreign key constraint failed error -->
                    <td>
                        <button type="submit" class="btn btn-primary mt-2">
                            <i class="bi bi-bag-plus"></i>
                        </button>
                    </td>
                </form>
                }
            </tr>
        </tbody>
    </table>
</div>
}

<!-- el nombre de la propiedad del ViewModel tambien tiene que coincidir -->
<!-- con el nombre de lo que sea que recibe el controller -->
<!-- tu controller recibe Presupuesto presupuesto, el View model tiene que tener un Presupuesto presupuesto-->
<article class="d-flex justify-content-around">
    <fieldset class="container border border-2 border-success rounded w-50">
        <form asp-controller="Presupuesto" asp-action="CrearPresupuesto" class="p-2">
            <legend>Nuevo Presupuesto</legend>
            <article class="form-group">
                <label asp-for="@Model.presupuesto.IdCliente" class="form-label">Cliente N°</label>
                <input asp-for="@Model.presupuesto.IdCliente" class="form-control">
            </article>
            <article class="my-2 form-group">
                <label asp-for="@Model.presupuesto.FechaCreacion" class="form-label">Fecha: </label>
                <input asp-for="@Model.presupuesto.FechaCreacion" class="form-control">
            </article>
            <article class="p-3 d-flex justify-content-center">
                <input type="submit" value="Registrar" class="btn btn-primary">
            </article>
        </form>
    </fieldset>
</article>